---
import { Image } from 'astro:assets';
import BaseLayout from "../layouts/BaseLayout.astro";
import Socials from "../components/Socials.astro";
import { getCollection } from 'astro:content';

const pageTitle = "Matthew Cobbing - Technical Lead";

// Fetch all projects to determine which technologies have projects
const projects = await getCollection('projects');
const projectTechnologies = new Set(
  projects.flatMap(p => {
    if ('technologies' in p.data && Array.isArray(p.data.technologies)) {
      return (p.data.technologies as string[]).map((t: string) => t.toLowerCase());
    }
    return [];
  })
);

// Homepage technology display (preserves order and display text like emojis)
const homepageTechs = [
  { display: "Go", tech: "Go" },
  { display: "Rust ðŸ¦€", tech: "Rust" },
  { display: "TypeScript", tech: "TypeScript" },
  { display: "GraphQL", tech: "GraphQL" },
  { display: "Kubernetes", tech: "Kubernetes" },
  { display: "AWS", tech: "AWS" },
  { display: "Docker", tech: "Docker" },
  { display: "Protobuf", tech: "Protobuf" },
  { display: "Microservices", tech: "Microservices" },
  { display: "CI/CD", tech: "CI/CD" },
  { display: "PostgreSQL", tech: "PostgreSQL" },
  { display: "Terraform", tech: "Terraform" },
  { display: "Frontend", tech: "Frontend" },
];
---

<BaseLayout pageTitle={pageTitle}>
  <div class="hero-container">
    <!-- Profile image with animated glow -->
    <div class="profile-wrapper">
      <Image 
        class="profile" 
        src="/profile.jpeg" 
        alt="Matthew Cobbing" 
        width={250} 
        height={250}
        loading="eager"
      />
    </div>
    
    <!-- Name and title -->
    <h1>Matthew Cobbing</h1>
    
    <!-- Terminal-style typewriter greeting -->
    <div class="terminal-greeting">
      <span class="prompt">&gt;</span> 
      <span id="typewriter"></span>
      <span class="cursor">_</span>
    </div>
    
    <!-- Tech stack badges -->
    <div class="tech-stack">
      {homepageTechs.map((item, index) => {
        const hasProjects = projectTechnologies.has(item.tech.toLowerCase());
        
        return hasProjects ? (
          <a 
            href={`/projects/${item.tech.toLowerCase()}`}
            class="tech-badge tech-badge-clickable"
            style={`animation-delay: ${0.1 * (index + 1)}s`}
          >
            {item.display}
          </a>
        ) : (
          <span 
            class="tech-badge tech-badge-muted"
            style={`animation-delay: ${0.1 * (index + 1)}s`}
          >
            {item.display}
          </span>
        );
      })}
    </div>
    
    <!-- Social links -->
    <Socials />
  </div>

  <script>
    import { initTypewriter } from '../scripts/typewriter';
    
    initTypewriter('typewriter', [
      'Building scalable backend platforms that power real-world products.',
      'Turning complex distributed systems into clean, reliable architecture.',
      'Designing APIs that are simple to use and easy to evolve.',
      'Shaping technical direction and guiding teams through big changes.',
      'Writing Go and Rust to make things fast and stable.',
    ]);
  </script>
</BaseLayout>

<style>
  .hero-container {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    min-height: calc(100vh - 6rem);
    padding: 0.5rem 0;
  }

  /* Terminal-style greeting */
  .terminal-greeting {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.2rem;
    color: var(--accent-green);
    margin: 0.5rem 0 1rem 0;
    text-align: center;
    min-height: 1.5em;
  }

  .prompt {
    color: var(--accent-cyan);
    font-weight: bold;
    margin-right: 0.5rem;
  }

  /* Profile image with animated glow */
  .profile-wrapper {
    position: relative;
    display: inline-block;
    margin: 0 0 1.5rem 0;
    padding: 4px;
  }

  .profile-wrapper::before {
    content: '';
    position: absolute;
    inset: -4px;
    border-radius: 50%;
    background: linear-gradient(45deg, var(--accent-cyan), var(--accent-green), var(--accent-cyan));
    background-size: 200% 200%;
    z-index: 0;
    animation: rotate-gradient 3s linear infinite;
  }

  @keyframes rotate-gradient {
    0% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
    100% {
      background-position: 0% 50%;
    }
  }

  .profile {
    border-radius: 50%;
    position: relative;
    z-index: 2;
    display: block;
    transition: transform 0.3s var(--transition-smooth);
    background: #000;
  }

  .profile:hover {
    transform: scale(1.05);
  }

  /* Name and title */
  h1 {
    margin: 0.5rem 0 0.5rem 0;
    text-align: center;
  }

  /* Tech stack badges */
  .tech-stack {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    justify-content: center;
    margin: 0.75rem 0 1rem 0;
    max-width: 600px;
  }

  .tech-badge {
    padding: 0.4rem 0.8rem;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    font-size: 0.875rem;
    font-family: 'JetBrains Mono', monospace;
    transition: all 0.3s var(--transition-smooth);
    opacity: 0;
    animation: fadeInUp 0.6s forwards;
    display: inline-block;
  }

  /* Clickable tags (with projects) */
  .tech-badge-clickable {
    cursor: pointer;
    text-decoration: none;
    color: inherit;
  }

  .tech-badge-clickable:hover {
    background: rgba(0, 212, 255, 0.1);
    border-color: var(--accent-cyan);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 212, 255, 0.2);
  }

  /* Non-clickable tags (no projects) - muted appearance */
  .tech-badge-muted {
    opacity: 0.6;
    cursor: default;
  }

  /* No hover effect for muted badges */
  .tech-badge-muted:hover {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    transform: none;
    box-shadow: none;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Mobile responsiveness */
  @media (max-width: 768px) {
    .terminal-greeting {
      font-size: 1rem;
    }

    .tech-stack {
      max-width: 100%;
      padding: 0 1rem;
    }

    .tech-badge {
      font-size: 0.75rem;
      padding: 0.3rem 0.6rem;
    }
  }
</style>
